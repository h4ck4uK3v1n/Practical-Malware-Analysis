# Lab 01-01

> This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below.

- Questions:
  - 1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?
  - 2. When were these files compiled?
  - 3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?
  - 4. Do any imports hint at what this malware does? If so, which imports are they?
  - 5. Are there any other files or host-based indicators that you could look for on infected systems?
  - 6. What network-based indicators could be used to find this malware on infected machines?
  - 7. What would you guess is the purpose of these files?

## 1) VirusTotal Detections?

- File `Lab01-01.exe`:
  - **SHA256**: `58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47`.
  - **File name**: Lab01-01.exe
  - **Community Score**: 51/71
  - **First Submission**: 2012-02-16 07:31:54 UTC
- File `Lab01-01.dll`:
  - **SHA256**: `f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba`.
  - **File name**: Lab01-01.dll
  - **Community Score**: 38/71
  - **First Submission**: 2011-07-04 19:57:48 UTC

## 2) Compilation Date?

- Check in `VirusTotal/Details`:

  - File `Lab01-01.exe`: 2010-12-19 16:16:19 UTC
  - File `Lab01-01.dll`: 2010-12-19 16:16:38 UTC

- OR using `PEview` we are able to view this information. The information is found under: `IMAGE_NT_HEADERS > IMAGE_FILE_HEADER > Time Date Stamp`.

## 3) Packed/Obfuscated?

- Use tools `Detect-It-Easy`:
  - File `Lab01-01.exe`: No indication
  - File `Lab01-01.dll`: No indication

## 4) Import Directory Hints?

- Use tools `CFF Explorer/Imports Directory`: Thông qua các Dll và API được gọi thì chương trình sẽ tìm kiếm và sao chép tệp, tạo processes và hoạt động qua mạng.

- File `Lab01-01.exe`:
  - KERNEL32.dll
    - CopyFileA()
    - FindFirstFileA()
    - FindNextFileA()
  - MSVCRT.dll
    - \_stricmp()
- File `Lab01-01.dll`:
  - KERNEL32.dll
    - CreateMutexA()
    - CreateProcessA()
    - Sleep()
  - WS2_32.dll
    - Sử dụng bằng cách gọi theo số thứ tự và khi khớp thì là các hàm closesocket, connect, htons, inet_addr, recv, send, shutdown, socket, WSAStartup, WSACleanup.
  - MSVCRT.dll
    - strncmp()

## 5) Host Based Indicators?

- Use tools `PEstudio` (or `BinText`): Phân tích strings ta thu được kết quả:

  - 1. Chuỗi tên Dll sai `kerne132.dll`, thay vì là chữ `l` thì nó là số `1`.
  - 2. Chuỗi lạ `WARNING_THIS_WILL_DESTROY_YOUR_MACHINE`.
  - 3. Chuỗi lạ địa chỉ IP `127.26.152.13`.
  - 4. Các chuỗi như `sleep`, `hello` và `exec` giống như các commands yêu cầu.

- `Lab01-01.exe strings:`:

```ps1
000000026018   000010026018      0   sleep
000000026020   000010026020      0   hello
000000026028   000010026028      0   127.26.152.13
000000026038   000010026038      0   SADFHUHF
```

- `Lab01-01.dll strings:`:

```ps1
000000003010   000000403010      0   kerne132.dll
000000003020   000000403020      0   kernel32.dll
00000000304C   00000040304C      0   C:\windows\system32\kerne132.dll
000000003070   000000403070      0   Kernel32.
00000000307C   00000040307C      0   Lab01-01.dll
00000000308C   00000040308C      0   C:\Windows\System32\Kernel32.dll
000000003010   000000403010      0   kerne132.dll
000000003020   000000403020      0   kernel32.dll
0000000030B0   0000004030B0      0   WARNING_THIS_WILL_DESTROY_YOUR_MACHINE
```

## 6) Network Based Indicators?

- Chương trình có thể đang kết nối hoặc tương tác mạng với 1 địa chỉ IP lạ `127.26.152.13`.

## 7) Suggested Purpose?

- Sao chép qua mạng tới máy nạn nhân 1 Dll và đổi tên nó thành `kerne132.dll`, đây có thể là backdoor tương tác với địa chỉ IP `127.26.152.13` và cho phép thực thi các lệnh hello, sleep và exec. Hacker có thể yêu cầu chương trình chuyển sang chế độ ngủ hoặc thực thi các lệnh trên hệ thống bị nhiễm.
