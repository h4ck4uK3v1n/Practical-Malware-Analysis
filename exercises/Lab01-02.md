# Lab 01-02

> Analyze the file Lab01-02.exe.

- Questions:
  - 1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
  - 2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
  - 3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
  - 4. What host- or network-based indicators could be used to identify this malware on infected machines?

## 1) VirusTotal Detections?

- File `Lab01-02.exe`:
  - **SHA256**: `c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6`.
  - **File name**: Lab01-02.exe
  - **Community Score**: 58/72
  - **First Submission**: 2011-07-02 17:02:09 UTC
  - **Creation Time**: 2011-01-19 16:10:41 UTC

## 2) Packed/Obfuscated?

- Use tools `Detect-It-Easy`:
  - File `Lab01-02.exe`: Packer: UPX(3.04)[NRV,best]

```ps1
Microsoft Windows [Version 10.0.19045.4239]
(c) Microsoft Corporation. All rights reserved.

C:\Users\trant\Downloads\PracticalMalwareAnalysis-Labs\Practical Malware Analysis Labs\BinaryCollection\Chapter_1L>upx.exe -d -o Lab01-02_unpacked.exe Lab01-02.exe
                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2024
UPX 4.2.3       Markus Oberhumer, Laszlo Molnar & John Reiser   Mar 27th 2024

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
     16384 <-      3072   18.75%    win32/pe     Lab01-02_unpacked.exe

Unpacked 1 file.

C:\Users\trant\Downloads\PracticalMalwareAnalysis-Labs\Practical Malware Analysis Labs\BinaryCollection\Chapter_1L>
```

## 3) Import Directory Hints?

- Use tools `CFF Explorer/Imports Directory`: Creates threads, manipulates services, and communicates over the network, likely HTTP. Something to do with time. Checks for an update or command over the network? Starts a service?

  - KERNEL32.DLL

    - SystemTimeToFileTime
    - GetModuleFileNameA
    - CreateMutexA
    - CreateThread
    - SetWaitableTimer

  - ADVAPI32.DLL

    - CreateServiceA
    - StartServiceCtrlDispatcherA
    - OpenSCManagerA

  - WININET.DLL

    - InternetOpenUrlA
    - InternetOpenA

## 4) Host/Network Based Indicators?

- Use tools `PEstudio` (or `BinText`): Phân tích strings ta thu được kết quả:

  - 1. Services or mutexes named `MalService`, `Malservice` or `HGL345`.
  - 2. Network communication with `http://www.malwareanalysisbook.com`.
  - 3. HTTP requests with user-agent `Internet Explorer 8.0`.
  - 4. Các chuỗi khả nghi trong file:

  ```ps1
  000000003010   000000403010      0   MalService
  00000000301C   00000040301C      0   Malservice
  000000003028   000000403028      0   HGL345
  000000003030   000000403030      0   http://www.malwareanalysisbook.com
  000000003054   000000403054      0   Internet Explorer 8.0
  ```
